<div id="registerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center opacity-0 transition-opacity duration-300">
    <div id="registerBox"
         class="bg-white w-11/12 max-w-md p-6 shadow-2xl relative border border-gray-300
                opacity-0 scale-90 transition-all duration-300"
         onclick="event.stopPropagation()">

        <div class="flex justify-between mb-6">
            <h2 class="text-3xl font-bold text-teal-800">Registrasi Akun</h2>
            
            <button onclick="closeRegisterModal()" 
                    class="text-gray-600 hover:text-gray-800 text-2xl">
                &times;
            </button>
        </div>

        <form id="registerForm" class="space-y-5" autocomplete="off" method="post">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                <div class="relative">
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">
                        <i class="fa-solid fa-user"></i>
                    </span>
                    <input type="text" name="reg-username"
                        class="w-full pl-10 pr-3 py-2 border border-gray-300 focus:ring-2 focus:ring-teal-600 focus:outline-none"
                        required>
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <div class="relative">
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">
                        <i class="fa-solid fa-lock"></i>
                    </span>

                    <input type="password" id="reg-password" name="reg-password"
                        class="w-full pl-10 pr-10 py-2 border border-gray-300 focus:ring-2 focus:ring-teal-600 focus:outline-none"
                        required>

                    <span class="absolute right-3 top-1/2 -translate-y-1/2 cursor-pointer text-gray-600"
                          onclick="togglePassword('reg-password', this)">
                        <i class="fa-solid fa-eye"></i>
                    </span>
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                <div class="relative">
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">
                        <i class="fa-solid fa-lock"></i>
                    </span>

                    <input type="password" id="reg-confirm-password" name="reg-confirm-password"
                        class="w-full pl-10 pr-10 py-2 border border-gray-300 focus:ring-2 focus:ring-teal-600 focus:outline-none"
                        required>

                    <span class="absolute right-3 top-1/2 -translate-y-1/2 cursor-pointer text-gray-600"
                          onclick="togglePassword('reg-confirm-password', this)">
                        <i class="fa-solid fa-eye"></i>
                    </span>
                </div>
            </div>

            <button type="submit"
                    class="px-5 py-2.5 w-full
                        font-semibold tracking-wide
                        bg-gradient-to-br from-teal-500 to-teal-600 
                        text-white 
                        shadow-md shadow-black/25
                        transition-all duration-300 ease-out
                        hover:from-teal-400 hover:to-teal-500
                        hover:-translate-y-0.5
                        active:scale-95 flex items-center gap-2 justify-center"
            >
                Register
                <i class="fas fa-paper-plane ml-1"></i>
            </button>
        </form>
    </div>
</div>

<script>
$(document).ready(function() {
    function openRegisterModal() {
        const $modal = $("#registerModal");
        const $box = $("#registerBox");

        $modal.removeClass("hidden");
        void $modal[0].offsetWidth;

        $modal.addClass("opacity-100");
        $box.addClass("opacity-100 scale-100");

        $('[name="reg-username"]').focus();
    }

    function closeRegisterModal() {
        const $modal = $("#registerModal");
        const $box = $("#registerBox");

        $modal.removeClass("opacity-100");
        $box.removeClass("opacity-100 scale-100");

        setTimeout(function(){
            $modal.addClass("hidden");
        }, 300);

        $("#registerForm")[0].reset();
    }

    $("#registerModal").click(closeRegisterModal);
    $("#registerBox").click(function(e){ e.stopPropagation(); });

    window.togglePassword = function(id, iconElement) {
        const $input = $("#" + id);
        const $icon = $(iconElement).find("i");

        if ($input.attr("type") === "password") {
            $input.attr("type", "text");
            $icon.removeClass("fa-eye").addClass("fa-eye-slash");
        } else {
            $input.attr("type", "password");
            $icon.removeClass("fa-eye-slash").addClass("fa-eye");
        }
    }

    $("#registerForm").submit(function(e){
        e.preventDefault();

        const username = $.trim($("input[name='reg-username']").val());
        const password = $.trim($("input[name='reg-password']").val());
        const confirm_password = $.trim($("input[name='reg-confirm-password']").val());
        
        $.ajax({
            url: "/register",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({ username: username, password: password, confirm_password: confirm_password }),
            beforeSend: function() {
                ShowLoading();
            },
            success: function(res){
                $("#registerForm")[0].reset();
                closeRegisterModal();
                Swal.fire({
                    icon: 'success',
                    title: 'Berhasil!',
                    text: res.message,
                    confirmButtonColor: '#13b4a2',
                    timer: 2000,
                    timerProgressBar: true
                });
            },
            error: function(xhr){
                let errMsg = "Terjadi kesalahan!";
                if(xhr.responseJSON && xhr.responseJSON.error){
                    errMsg = xhr.responseJSON.error;
                }
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: errMsg,
                    confirmButtonColor: '#F87171'
                });
            },
            complete: function() {
                HideLoading();
            }
        });
    });

    window.openRegisterModal = openRegisterModal;
    window.closeRegisterModal = closeRegisterModal;
});
</script>