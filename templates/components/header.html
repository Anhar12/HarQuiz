<header class="bg-[#0a3234] text-white shadow-lg head-font sticky top-0 z-50">
    <nav class="mx-auto py-3 px-6 md:px-12 flex items-center justify-between">

        <!-- Logo -->
        <a href="/" class="flex items-center gap-3">
            <img src="/static/img/sec-logo.jpeg" alt="HarQuiz Logo" class="h-10">
        </a>

        <!-- Hamburger (mobile) -->
        <button id="menuBtn" class="text-white text-2xl md:hidden">
            <i class="fa-solid fa-bars"></i>
        </button>

        {% set current = request.path %}
        {% set logged_in = current_user.is_authenticated %}
        <!-- Desktop menu -->
        <ul class="hidden md:flex gap-8 text-md items-center">
            <li>
                <a href="/" class="{% if current == '/' %}text-teal-300{% else %}hover:text-teal-300{% endif %}">
                    <i class="fa-solid fa-house mr-1"></i> Home
                </a>
            </li>

            {% if logged_in %}
                <li>
                    <a href="/quiz" class="{% if current.startswith('/quiz') %}text-teal-300{% else %}hover:text-teal-300{% endif %}">
                        <i class="fa-solid fa-circle-question mr-1"></i> Quiz
                    </a>
                </li>

                <li>
                    <a href="/leaderboard" class="{% if current.startswith('/leaderboard') %}text-teal-300{% else %}hover:text-teal-300{% endif %}">
                        <i class="fa-solid fa-ranking-star mr-1"></i> Leaderboard
                    </a>
                </li>

                <li>
                    <span class="px-4 py-2 font-semibold bg-gradient-to-br from-teal-500 to-teal-600 text-white shadow-md hover:from-teal-400 hover:to-teal-500">
                        <i class="fa-solid fa-user mr-1"></i> {{ current_user.username }}
                    </span>
                </li>

                <li>
                    <button onclick="logout()" class="px-4 py-1.5 font-semibold bg-gradient-to-br from-red-700 to-red-800 text-white shadow-md hover:from-red-600 hover:to-red-700">
                        <i class="fa-solid fa-right-from-bracket mr-1"></i> Logout
                    </button>
                </li>
            {% else %}
                <li>
                    <a href="/leaderboard" class="{% if current.startswith('/leaderboard') %}text-teal-300{% else %}hover:text-teal-300{% endif %}">
                        <i class="fa-solid fa-ranking-star mr-1"></i> Leaderboard
                    </a>
                </li>    

                <li>
                    <button onclick="openLoginModal()" class="hover:text-teal-300">
                        <i class="fa-solid fa-right-to-bracket mr-1"></i> Login
                    </button>
                </li>

                <li>
                    <button onclick="openRegisterModal()" class="px-4 py-2 font-semibold bg-gradient-to-br from-teal-500 to-teal-600 text-white shadow-md hover:from-teal-400 hover:to-teal-500">
                        <i class="fa-solid fa-user-plus mr-1"></i> Register
                    </button>
                </li>
            {% endif %}
        </ul>
    </nav>

    <!-- MOBILE SIDEBAR MENU -->
    <div id="sidebarOverlay" class="fixed inset-0 bg-black/40 hidden opacity-0 transition-opacity duration-300"></div>

    <aside id="sidebarMenu"
        class="fixed top-0 left-0 w-64 h-full bg-[#0a3234] text-white shadow-xl transform -translate-x-full transition-transform duration-300 z-50 flex flex-col py-6 px-6 md:hidden">
        
        <div class="flex justify-between items-center pb-6">
            <a href="/" class="">
                <img src="/static/img/sec-logo.jpeg" alt="HarQuiz Logo" class="h-8">
            </a>

            <button id="closeSidebar" class="text-white text-2xl">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>

        <ul class="flex flex-col gap-6 text-lg">
            <li>
                <a href="/" class="{% if current == '/' %}text-teal-300{% else %}hover:text-teal-300{% endif %}">
                    <i class="fa-solid fa-house mr-2"></i> Home
                </a>
            </li>

            {% if logged_in %}
                <li>
                    <a href="/quiz" class="{% if current.startswith('/quiz') %}text-teal-300{% else %}hover:text-teal-300{% endif %}">
                        <i class="fa-solid fa-circle-question mr-2"></i> Quiz
                    </a>
                </li>

                <li>
                    <a href="/leaderboard" class="{% if current.startswith('/leaderboard') %}text-teal-300{% else %}hover:text-teal-300{% endif %}">
                        <i class="fa-solid fa-ranking-star mr-2"></i> Leaderboard
                    </a>
                </li>
                
                <li>
                    <span class="px-4 py-2 font-semibold bg-gradient-to-br from-teal-500 to-teal-600 text-white shadow-md hover:from-teal-400 hover:to-teal-500">
                        <i class="fa-solid fa-user mr-1"></i> {{ current_user.username }}
                    </span>
                </li>

                <li>
                    <button onclick="logout()" class="px-4 py-2 font-semibold bg-gradient-to-br from-red-700 to-red-800 text-white shadow-md hover:from-red-600 hover:to-red-700">
                        <i class="fa-solid fa-right-from-bracket mr-1"></i> Logout
                    </button>
                </li>
            {% else %}
                <li>
                    <a href="/leaderboard" class="{% if current.startswith('/leaderboard') %}text-teal-300{% else %}hover:text-teal-300{% endif %}">
                        <i class="fa-solid fa-ranking-star mr-2"></i> Leaderboard
                    </a>
                </li>
            
                <li>
                    <button onclick="openLoginModal()" class="hover:text-teal-300">
                        <i class="fa-solid fa-right-to-bracket mr-2"></i> Login
                    </button>
                </li>

                <li>
                    <button onclick="openRegisterModal()" class="px-4 py-2 font-semibold bg-gradient-to-br from-teal-500 to-teal-600 text-white rounded shadow-md hover:from-teal-400 hover:to-teal-500">
                        <i class="fa-solid fa-user-plus mr-2"></i> Register
                    </button>
                </li>
            {% endif %}
        </ul>
    </aside>
</header>

<script>
    const btn = document.getElementById("menuBtn");
    const sidebar = document.getElementById("sidebarMenu");
    const overlay = document.getElementById("sidebarOverlay");
    const closeBtn = document.getElementById("closeSidebar");

    function openSidebar() {
        sidebar.classList.remove("-translate-x-full");
        overlay.classList.remove("hidden");
        setTimeout(() => overlay.classList.remove("opacity-0"), 10);
    }

    function closeSidebarFn() {
        sidebar.classList.add("-translate-x-full");
        overlay.classList.add("opacity-0");
        setTimeout(() => overlay.classList.add("hidden"), 300);
    }

    btn.onclick = openSidebar;
    closeBtn.onclick = closeSidebarFn;
    overlay.onclick = closeSidebarFn;

    $(document).ready(function() {
        function logout() {
            $.ajax({
                url: "/logout",
                type: "GET",
                beforeSend: function() {
                    ShowLoading();
                },
                success: function(res){
                    Swal.fire({
                        icon: 'success',
                        title: 'Berhasil!',
                        text: 'Berhasil logout',
                        confirmButtonColor: '#13b4a2',
                        allowOutsideClick: false,
                        timer: 2000,
                        timerProgressBar: true
                    }).then(() => {
                        location.reload();
                    });
                },
                error: function(xhr){
                    let errMsg = "Terjadi kesalahan!";
                    if(xhr.responseJSON && xhr.responseJSON.error){
                        errMsg = xhr.responseJSON.error;
                    }
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: errMsg,
                        confirmButtonColor: '#F87171'
                    });
                },
                complete: function() {
                    HideLoading();
                }
            });
        }

        window.logout = logout;
    });
</script>
